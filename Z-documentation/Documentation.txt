# Documentation de l'application de pr√©visions hebdomadaires de fr√©quentation

## I. Introduction

### 1.1 Objectif du document

Ce document vise √† fournir une description exhaustive et accessible de l'application d√©di√©e aux pr√©visions hebdomadaires de fr√©quentation. Il accompagne aussi bien les utilisateurs novices dans l'obtention de pr√©visions que les d√©veloppeurs chevronn√©s en qu√™te de compr√©hension du fonctionnement interne de l'application.  Ce guide d√©taill√© vous accompagnera √† chaque √©tape, de l'installation √† l'interpr√©tation des r√©sultats.

### 1.2 Description de l'application

Anticipation et pr√©cision sont les ma√Ætres mots de cette application. Con√ßue pour pr√©dire la fr√©quentation hebdomadaire d'un lieu pr√©cis, elle s'appuie sur la puissance du mod√®le de pr√©vision statistique SARIMAX (Seasonal Autoregressive Integrated Moving Average with eXogenous regressors).  Au-del√† des simples donn√©es historiques de fr√©quentation, le mod√®le int√®gre astucieusement des variables externes influentes pour affiner ses pr√©dictions :

* **Les caprices de la m√©t√©o :** Temp√©ratures maximales et minimales, pr√©cipitations, ensoleillement... rien n'√©chappe √† son analyse.
* **Le rythme des vacances scolaires :**  Les variations saisonni√®res de la fr√©quentation sont ainsi prises en compte.
* **Les jours f√©ri√©s :**  Leur impact sur la fr√©quentation est soigneusement int√©gr√©.
* **Les temps forts commerciaux :**  Soldes, lancements de produits phares (comme le dernier iPhone), tout est pass√© au crible.

Gr√¢ce √† cette approche multifactorielle, l'application se distingue par la pr√©cision et la fiabilit√© de ses pr√©visions, s'imposant comme un outil d'aide √† la d√©cision incontournable.

#### 1.2.1 Fonctionnalit√©s cl√©s

L'application se veut accessible et intuitive.  Elle offre un panel de fonctionnalit√©s pens√©es pour simplifier son utilisation :

* **Ma√Ætrise du temps :**  Choisissez librement la p√©riode pour laquelle vous souhaitez obtenir des pr√©visions.
* **Clart√© des r√©sultats :**  Visualisez les pr√©visions hebdomadaires de mani√®re claire et concise gr√¢ce √† des tableaux et des graphiques interactifs.
* **Gestion de l'incertitude :**  Un intervalle de confiance accompagne chaque pr√©vision, vous permettant d'appr√©hender les fluctuations potentielles.
* **Analyse comparative :**  Comparez ais√©ment les pr√©visions avec les donn√©es des ann√©es pr√©c√©dentes pour une analyse contextuelle approfondie.

#### 1.2.2 Architecture g√©n√©rale

D√©velopp√©e en Python, langage de pr√©dilection dans l'univers de la science des donn√©es, l'application s'articule autour d'un √©cosyst√®me de librairies sp√©cialis√©es :

* **Streamlit :**  L'interface utilisateur web, interactive et conviviale, est son ≈ìuvre.
* **Pandas :**  La manipulation et l'analyse des donn√©es sont ses terrains de jeux.
* **Statsmodels :**  C'est ici que r√©side l'impl√©mentation du mod√®le de pr√©vision SARIMAX.
* **Plotly :**  Il orchestre la cr√©ation de graphiques interactifs et visuellement attrayants.
* **Requests :**  Il interroge les API externes pour r√©cup√©rer les pr√©cieuses donn√©es m√©t√©o.
* **Joblib :**  C'est le gardien des mod√®les et des scalers, assurant leur sauvegarde et leur chargement pour une utilisation ult√©rieure.

### 1.3 Public cible

Ce document s'adresse √† un public large, aux profils vari√©s :

* **Les utilisateurs finaux :** Quiconque souhaite obtenir des pr√©visions de fr√©quentation, sans n√©cessairement poss√©der de comp√©tences techniques avanc√©es.
* **Les analystes de donn√©es :**  Ces experts trouveront ici un outil performant pour l'analyse des donn√©es de fr√©quentation et l'exploitation de mod√®les pr√©dictifs.
* **Les d√©veloppeurs :**  Ceux qui souhaitent explorer les coulisses du code source, l'adapter √† leurs besoins sp√©cifiques ou contribuer √† son √©volution y trouveront leur bonheur.


## II. Guide d'installation et de configuration

### 2.1 Pr√©requis

#### 2.1.1 Python et librairies

Avant de plonger dans l'univers des pr√©visions, assurez-vous d'avoir install√© Python 3.7 ou une version ult√©rieure sur votre syst√®me.  Un environnement virtuel Python est fortement recommand√© pour √©viter tout conflit de d√©pendances. Vous pouvez cr√©er un environnement virtuel avec la commande suivante : 

```bash
python -m venv .venv
```

Activez ensuite l'environnement virtuel :

```bash
# Sur Windows
.venv\Scripts\activate

# Sur macOS/Linux
source .venv/bin/activate
```

Une fois Python et votre environnement virtuel pr√™ts, installez les librairies n√©cessaires √† l'aide de la commande `pip` :

```bash
pip install -r requirements.txt
```

Le fichier `requirements.txt` contient la liste compl√®te des d√©pendances du projet.

#### 2.1.2 Configuration du proxy CNTLM (pour le r√©seau interne de l'entreprise)

Si vous utilisez cette application au sein du r√©seau interne de l'entreprise, la configuration d'un proxy CNTLM est indispensable pour acc√©der aux API externes, notamment celle fournissant les donn√©es m√©t√©orologiques. CNTLM agit comme un interm√©diaire, permettant √† votre application de se connecter √† Internet via le serveur proxy de l'entreprise.

##### 2.1.2.1 Installation de CNTLM

1. T√©l√©chargez la derni√®re version du fichier zip CNTLM depuis le site officiel.
2. D√©compressez le contenu du fichier zip dans le r√©pertoire `C:\Applications\cntlm`.

##### 2.1.2.2 Configuration de CNTLM

1. Ouvrez le fichier `cntlm.ini` situ√© dans le r√©pertoire `C:\Applications\cntlm` √† l'aide d'un √©diteur de texte.
2. Localisez la ligne contenant `Password` et supprimez-la.
3. Remplacez les valeurs suivantes par vos propres informations d'identification :

```
Username VOTRE_CUID
Domain AD
Proxy proxybkp.si.francetelecom.fr:8080
Proxy proxy.si.francetelecom.fr:8080
```

4. G√©n√©rez un hash pour votre mot de passe e-buro en ex√©cutant la commande suivante dans une console Cmder ouverte dans le r√©pertoire `C:\Applications\cntlm` :

```bash
cntlm -H -u VOTRE_CUID -d AD -c cntlm.ini http://www.google.com
```

Remplacez `VOTRE_CUID` par votre CUID.
Entrez votre mot de passe e-buro lorsque vous y √™tes invit√©.
Copiez le hash g√©n√©r√© (par exemple, `2AB3390716014AE4399917D8330A91F7`).

5. De retour dans le fichier `cntlm.ini`, ajoutez les lignes suivantes en rempla√ßant le hash par celui que vous venez de copier :

```
Auth NTLMv2
PassNTLMv2 2AB3390716014AE4399917D8330A91F7
```

##### 2.1.2.3 V√©rification de l'installation

1. Lancez CNTLM en mode console en ex√©cutant la commande suivante dans une console Cmder ouverte dans le r√©pertoire `C:\Applications\cntlm` :

```bash
cntlm -c cntlm.ini -v
```

2. Ouvrez une nouvelle console Cmder et v√©rifiez l'acc√®s √† un site web externe √† l'aide de la commande `curl` :

```bash
curl -x localhost:3128 http://www.google.com
```

Si la configuration est correcte, vous devriez obtenir le code source HTML de la page d'accueil de Google.

##### 2.1.2.4 D√©marrage automatique de CNTLM

Pour √©viter de lancer CNTLM manuellement √† chaque d√©marrage de votre ordinateur, suivez ces √©tapes :

1. Dans le r√©pertoire `C:\Applications\cntlm`, cr√©ez un fichier nomm√© `startCntlm.bat` avec le contenu suivant :

```bash
cntlm.exe -c cntlm.ini -f -v
cmd /k
```

2. Cr√©ez un raccourci vers `C:\Applications\cntlm\startCntlm.bat` dans le r√©pertoire de d√©marrage de Windows :
`C:\Users\VOTRE_NOM_D_UTILISATEUR\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup`

##### 2.1.2.5 D√©clarer le proxy CNTLM comme proxy par d√©faut

1. Ouvrez une console **en tant qu'administrateur** et ex√©cutez les commandes suivantes :

```bash
setx PROXY http://localhost:3128
setx HTTPS_PROXY http://localhost:3128
setx HTTP_PROXY http://localhost:3128
```

2. **Red√©marrez votre ordinateur** pour que les modifications soient prises en compte.

### 2.2 T√©l√©chargement du code source

Le code source de l'application est disponible sur le d√©p√¥t Git [ins√©rer le lien du d√©p√¥t Git]. Vous pouvez le t√©l√©charger sous forme de fichier zip ou cloner le d√©p√¥t √† l'aide de la commande `git clone`.

### 2.3 Configuration de l'application

#### 2.3.1 Fichier `config.py`

Le fichier `config.py` est le centre n√©vralgique de la configuration de l'application. Il contient les param√®tres essentiels au bon fonctionnement de l'application, tels que :

* **`MODEL_PATH`**: Chemin vers le r√©pertoire contenant les fichiers du mod√®le.
* **`CIBLE`**: Nom de la zone cible pour le mod√®le.
* **`HISTORICAL_FILE`**: Chemin vers le fichier Excel contenant les historiques de flux.
* **`LAT`**: Latitude de la zone d'√©tude.
* **`LON`**: Longitude de la zone d'√©tude.
* **`API_METEO_URL`**: URL de l'API d'archive m√©t√©o.
* **`USE_PROXY`**: Indique si un proxy doit √™tre utilis√© pour les requ√™tes externes.
* **`PROXY_URL`**: Adresse du proxy (CNTLM par d√©faut sur localhost).

**Exemple de fichier `config.py`:**

```python
# === R√©pertoires ===
# R√©pertoire principal pour les mod√®les
MODEL_PATH = r"C:/Chemin/Vers/Vos/Modeles"

# === Fichiers de Mod√®les ===
CIBLE = 'NomDeVotreCible'  # Zone cible pour le mod√®le

# ... autres configurations ...
```

**Param√®tres √† modifier :**

* **`MODEL_PATH`**: Remplacez `C:/Chemin/Vers/Vos/Modeles` par le chemin r√©el vers le r√©pertoire contenant les fichiers du mod√®le.
* **`CIBLE`**: Remplacez `NomDeVotreCible` par le nom de la zone cible pour le mod√®le.
* **`HISTORICAL_FILE`**: Remplacez le chemin par le chemin r√©el vers votre fichier Excel contenant les historiques de flux.
* **`LAT`**: Remplacez par la latitude de votre zone d'√©tude.
* **`LON`**: Remplacez par la longitude de votre zone d'√©tude.
* **`USE_PROXY`**: D√©finissez sur `True` si vous √™tes sur le r√©seau de l'entreprise et que vous utilisez CNTLM, sinon `False`.

Assurez-vous de bien adapter ces param√®tres √† votre environnement et √† vos besoins sp√©cifiques.

## III. Guide d'utilisation

### 3.1 Lancement de l'application

Une fois l'installation et la configuration termin√©es, vous pouvez lancer l'application. Pour cela, ouvrez votre terminal ou votre invite de commande, d√©placez-vous dans le r√©pertoire o√π se trouve le fichier `app.py` √† l'aide de la commande `cd`, puis ex√©cutez la commande suivante :

```bash
streamlit run app.py
```

Votre navigateur web par d√©faut s'ouvrira automatiquement et affichera l'interface utilisateur de l'application. Vous serez accueilli par un titre clair et une interface conviviale.

### 3.2 S√©lection de la plage de pr√©vision

L'application vous permet de choisir la p√©riode pour laquelle vous souhaitez obtenir des pr√©visions de fr√©quentation. Par d√©faut, la plage s√©lectionn√©e couvre les 4 semaines pr√©c√©dant la date du jour et les 4 semaines suivantes. Vous pouvez modifier cette plage en utilisant le s√©lecteur de dates, qui s'affiche clairement sur l'interface. N'h√©sitez pas √† ajuster la p√©riode en fonction de vos besoins d'analyse.

### 3.3 Lancement de la pr√©vision

Apr√®s avoir s√©lectionn√© la plage de dates souhait√©e, cliquez sur le bouton "Lancer la pr√©vision üöÄ".  L'application se met alors en marche et effectue les op√©rations suivantes :

1. **R√©cup√©ration des donn√©es :**  L'application collecte les donn√©es m√©t√©orologiques et les variables exog√®nes pour la p√©riode s√©lectionn√©e.
2. **Chargement du mod√®le :** Le mod√®le de pr√©vision SARIMAX, pr√©alablement entra√Æn√©, est charg√© en m√©moire, accompagn√© des scalers et du composant PCA utilis√©s pour le pr√©traitement des donn√©es.
3. **Pr√©vision :**  Le mod√®le utilise les donn√©es collect√©es pour calculer les pr√©visions de fr√©quentation.
4. **Affichage des r√©sultats :**  Les r√©sultats, clairs et concis, s'affichent sur l'interface.

### 3.4 Interpr√©tation des r√©sultats

L'application pr√©sente les r√©sultats de mani√®re intuitive et accessible, m√™me pour les utilisateurs moins familiers avec les analyses statistiques.

#### 3.4.1 Tableau de pr√©visions

Un tableau synth√©tique pr√©sente les pr√©visions hebdomadaires pour la p√©riode s√©lectionn√©e. Chaque ligne du tableau correspond √† une semaine, avec les informations cl√©s suivantes :

* **Date :**  Premier jour de la semaine (lundi), pour une identification rapide.
* **Pr√©vision :** Valeur pr√©dite par le mod√®le pour la fr√©quentation de la semaine, vous donnant une id√©e pr√©cise de l'affluence attendue.
* **Borne inf√©rieure :**  Limite inf√©rieure de l'intervalle de confiance √† 95%, indiquant la borne basse plausible pour la pr√©vision.
* **Borne sup√©rieure :** Limite sup√©rieure de l'intervalle de confiance √† 95%, indiquant la borne haute plausible pour la pr√©vision.

L'intervalle de confiance est un √©l√©ment crucial pour √©valuer la fiabilit√© de la pr√©vision. Plus l'intervalle est √©troit, plus la pr√©vision est consid√©r√©e comme fiable.

#### 3.4.2 Graphique de pr√©visions

Un graphique interactif, plus visuel, vient compl√©ter le tableau en affichant les pr√©visions, l'intervalle de confiance et les donn√©es historiques des deux ann√©es pr√©c√©dentes. Ce graphique offre plusieurs avantages :

* **Comparaison avec le pass√© :**  Visualisez facilement les pr√©visions par rapport aux tendances observ√©es les ann√©es pr√©c√©dentes.
* **Identification des tendances :**  Rep√©rez rapidement les p√©riodes de forte et de faible fr√©quentation gr√¢ce √† la repr√©sentation graphique.
* **Analyse des facteurs externes :**  Analysez l'impact des variables exog√®nes, telles que la m√©t√©o ou les vacances scolaires, sur les pr√©visions.

#### 3.4.3 Graphique des historiques

Un graphique d√©di√© √† l'historique complet des donn√©es de fr√©quentation pour la zone cible est √©galement disponible. Il permet de :

* **Visualiser l'√©volution sur le long terme :** Observez les tendances de fr√©quentation sur une p√©riode plus longue.
* **Identifier les saisonnalit√©s :**  Rep√©rez les sch√©mas saisonniers et les √©v√©nements exceptionnels qui ont pu influencer la fr√©quentation.
* **Comparer avec les pr√©visions :**  Mettez en perspective les pr√©visions avec l'ensemble des donn√©es historiques pour une analyse compl√®te.

## IV. Description technique

### 4.1 Structure du code

L'application est structur√©e en plusieurs modules Python, chacun ayant un r√¥le sp√©cifique :

#### 4.1.1 `app.py`

Ce module repr√©sente le c≈ìur de l'application. Il orchestre l'ensemble des fonctionnalit√©s, de l'affichage de l'interface utilisateur √† la r√©cup√©ration des donn√©es, en passant par le lancement des pr√©visions et la visualisation des r√©sultats. 

* **Interface utilisateur :** D√©finit la structure de l'interface utilisateur √† l'aide de la librairie Streamlit.
* **Gestion des √©v√©nements :** G√®re les interactions de l'utilisateur, comme la s√©lection de la plage de dates et le clic sur le bouton de lancement des pr√©visions.
* **Orchestration des modules :** Appelle les fonctions des autres modules pour r√©cup√©rer les donn√©es, charger le mod√®le, effectuer les pr√©visions et afficher les r√©sultats.

#### 4.1.2 `exogenous.py`

Ce module est responsable de la gestion des variables exog√®nes. Il contient les fonctions permettant de :

* **R√©cup√©rer les donn√©es m√©t√©orologiques :**  Utilise la classe `WeatherDataFetcher` pour interroger l'API m√©t√©o et r√©cup√©rer les donn√©es historiques ou pr√©vues pour la zone d'√©tude.
* **Cr√©er les variables exog√®nes :**  Calcule les variables bas√©es sur la date, comme les vacances scolaires, les soldes, les jours f√©ri√©s, etc.
* **Agr√©ger les donn√©es :**  Agr√©ger les donn√©es m√©t√©orologiques et les variables exog√®nes √† la semaine pour les aligner sur la granularit√© des pr√©visions.

#### 4.1.3 `forecast.py`

Ce module est d√©di√© √† la pr√©vision elle-m√™me. Il contient les fonctions pour :

* **Charger le mod√®le et les scalers :** Charge le mod√®le SARIMAX, les scalers et le composant PCA pr√©alablement entra√Æn√©s et sauvegard√©s.
* **Pr√©parer les donn√©es pour la pr√©vision :**  Transforme les donn√©es exog√®nes en utilisant les scalers et le composant PCA.
* **Effectuer la pr√©vision :**  Utilise le mod√®le SARIMAX pour g√©n√©rer les pr√©visions de fr√©quentation.
* **D√©normaliser les pr√©visions :**  Convertit les pr√©visions normalis√©es en valeurs r√©elles √† l'aide des scalers.

#### 4.1.4 `data_loader.py`

Ce module est responsable du chargement et du pr√©traitement des donn√©es historiques de fr√©quentation. Il contient les fonctions pour :

* **Charger les donn√©es depuis le fichier Excel :**  Lit le fichier Excel contenant les historiques de flux.
* **Pr√©parer les donn√©es :**  Convertit les colonnes 'Ann√©e' et 'Semaine' en une colonne de date, g√®re les p√©riodes de confinement en rempla√ßant les valeurs manquantes, et interpole les donn√©es pour combler les trous.

#### 4.1.5 `visualizations.py`

Ce module est d√©di√© √† la cr√©ation des graphiques. Il contient les fonctions pour :

* **Tracer le graphique des pr√©visions :**  Affiche les pr√©visions, l'intervalle de confiance et les donn√©es historiques des deux ann√©es pr√©c√©dentes.
* **Tracer le graphique des historiques complets :**  Affiche l'historique complet des donn√©es de fr√©quentation disponibles.

#### 4.1.6 `config.py`

Ce module centralise les param√®tres de configuration de l'application, tels que :

* **Chemins vers les fichiers :**  D√©finit les chemins vers les fichiers du mod√®le, les donn√©es historiques, etc.
* **Param√®tres du mod√®le :**  D√©finit le nom de la zone cible pour le mod√®le.
* **Param√®tres de l'API m√©t√©o :**  D√©finit les coordonn√©es g√©ographiques de la zone d'√©tude et l'URL de l'API m√©t√©o.
* **Configuration du proxy :**  D√©finit si un proxy doit √™tre utilis√© et son adresse.

### 4.2 Fonctionnement du mod√®le de pr√©vision

#### 4.2.1 Mod√®le SARIMAX

Le mod√®le de pr√©vision utilis√© est un mod√®le SARIMAX (Seasonal Autoregressive Integrated Moving Average with eXogenous regressors). Ce mod√®le est particuli√®rement adapt√© √† la pr√©vision de s√©ries temporelles pr√©sentant des tendances saisonni√®res et des influences de variables externes.

#### 4.2.2 Variables exog√®nes

Les variables exog√®nes jouent un r√¥le crucial dans la pr√©cision des pr√©visions. L'application utilise les variables exog√®nes suivantes :

* **Temp√©rature maximale et minimale :**  Influence sur la fr√©quentation en fonction des conditions climatiques.
* **Pr√©cipitations :**  Impact n√©gatif sur la fr√©quentation en cas de pluie.
* **Vacances scolaires :**  Augmentation de la fr√©quentation pendant les p√©riodes de vacances.
* **Soldes :**  Augmentation de la fr√©quentation pendant les p√©riodes de soldes.
* **Lancement d'un nouvel iPhone :**  Pic de fr√©quentation potentiel lors du lancement d'un nouveau mod√®le d'iPhone.
* **Jours f√©ri√©s :**  Impact variable sur la fr√©quentation en fonction du jour f√©ri√©.

#### 4.2.3 Chargement et pr√©traitement des donn√©es

Avant d'√™tre utilis√©es pour la pr√©vision, les donn√©es sont charg√©es, nettoy√©es et transform√©es :

* **Chargement :**  Les donn√©es historiques de fr√©quentation sont charg√©es depuis un fichier Excel, tandis que les donn√©es m√©t√©orologiques sont r√©cup√©r√©es depuis l'API Open-Meteo.
* **Nettoyage :**  Les p√©riodes de confinement, pendant lesquelles les donn√©es de fr√©quentation sont aberrantes, sont identifi√©es et remplac√©es par des valeurs manquantes.
* **Interpolation :**  Les valeurs manquantes sont interpol√©es pour combler les trous dans les donn√©es.
* **Transformation :**  Les donn√©es sont normalis√©es √† l'aide de scalers et une analyse en composantes principales (PCA) est appliqu√©e pour r√©duire la dimensionnalit√© des variables exog√®nes.

### 4.3 Maintenance et mises √† jour

Pour garantir la fiabilit√© des pr√©visions sur le long terme, il est important d'assurer la maintenance et la mise √† jour r√©guli√®re de l'application :

* **Mise √† jour des donn√©es :**  Int√©grer les nouvelles donn√©es de fr√©quentation et m√©t√©orologiques de mani√®re r√©guli√®re.
* **R√©entra√Ænement du mod√®le :**  R√©entra√Æner le mod√®le SARIMAX p√©riodiquement avec les donn√©es mises √† jour pour tenir compte des nouvelles tendances et des variations saisonni√®res.
* **Surveillance des performances :**  Surveiller les performances du mod√®le en comparant les pr√©visions avec les valeurs r√©elles et ajuster les param√®tres du mod√®le si n√©cessaire.
* **Veille technologique :**  Se tenir inform√© des nouvelles techniques de pr√©vision et des nouvelles API disponibles pour am√©liorer l'application.
```
